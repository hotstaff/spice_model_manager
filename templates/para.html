<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPICE Parameter Editor</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.7.0/nouislider.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.7.0/nouislider.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .parameter-container {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }
        .parameter-container label {
            flex: 1;
            margin-right: 10px;
        }
        .slider-wrapper {
            flex: 3;
            margin-right: 10px;
        }
        .parameter-container input {
            width: 80px;
            text-align: center;
            margin-right: 5px;
        }
        .parameter-unit {
            font-size: 0.9em;
            color: #555;
        }
    </style>
</head>
<body>
    <h1>SPICE Parameter Editor</h1>
    <form id="parameter-form">
        {% for param in parameters %}
        <div class="parameter-container">
            <label for="value-{{ param.name }}">{{ param.name }}:</label>
            <div class="slider-wrapper">
                <div id="slider-{{ param.name }}"></div>
            </div>
            <input type="text" id="value-{{ param.name }}" name="{{ param.name }}" value="{{ param.default }}" readonly>
            <span class="parameter-unit">{{ param.unit if param.unit else '' }}</span>
        </div>
        {% endfor %}
        <button type="submit">Submit</button>
    </form>

    <script>
        {% for param in parameters %}
        // スライダーを初期化
        const slider{{ loop.index }} = document.getElementById('slider-{{ param.name }}');
        const scale{{ loop.index }} = {{ param.scale }}; // スケールを考慮
        noUiSlider.create(slider{{ loop.index }}, {
            start: {{ param.default }},
            range: {
                min: {{ param.min}},
                max: {{ param.max }}
            },
            step: {{ (param.scale < 1 ? param.scale : 1) }}
        });

        // テキストボックスと連動
        const input{{ loop.index }} = document.getElementById('value-{{ param.name }}');
        slider{{ loop.index }}.noUiSlider.on('update', (values) => {
            input{{ loop.index }}.value = (values[0]).toFixed(2);
        });
        {% endfor %}
    </script>
</body>
</html>
